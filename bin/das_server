#!/bin/sh
# on Linux take advantage of proc system to figure out number of availabel CPUs
if [ -f /proc/cpuinfo ]; then
    ncpus=`cat /proc/cpuinfo | grep processor | tail -1 | awk '{v=1+$3; print v}'`
    export GOMAXPROCS=$ncpus
fi

# das2go server
das2go_server(){
    # check if das2go is running
    for (( ; ; )); do
        local pid=`ps auxwww | egrep "$cmd" | grep -v grep | awk 'BEGIN{ORS=" "} {print $2}'`
        echo "PID=$pid"
        if [ -z "$pid" ]; then
            local tstamp=`date "+%Y/%m/%d %H:%M:%S"`
            echo "$tstamp das2go is not running, restart"
            das2go
        fi
        sleep 10
    done
}
das2go_server
